# 🎬 Genie Match 캐스팅 솔루션 - 설정 가이드

## 📋 당신이 해야 할 작업 순서

### 1단계: 배우 데이터베이스 구축 🎭

레퍼런스로 사용할 유명 배우들의 이미지를 준비하고 인덱스를 생성합니다.

#### 1-1. 배우 이미지 폴더 준비

```
C:\data\actors\
  송강호\
    image1.jpg
    image2.jpg
    image3.jpg
  전지현\
    photo1.png
    photo2.png
  마동석\
    pic1.jpg
    pic2.jpg
  이정재\
    actor1.jpg
```

**중요**: 
- 각 배우마다 최소 3장 이상의 이미지를 준비하세요
- 정면, 측면 등 다양한 각도의 사진이 있으면 좋습니다
- 이미지 형식: JPG, PNG, WEBP
- 폴더 이름이 레퍼런스로 사용될 배우 이름입니다

#### 1-2. Python 환경 설정

```powershell
# 가상환경 활성화 (이미 했다면 생략)
.\.venv\Scripts\Activate

# 필요한 패키지가 모두 설치되어 있는지 확인
pip list | Select-String -Pattern "insightface|fastapi"
```

#### 1-3. 배우 인덱스 생성 (필수!)

```powershell
# 배우 임베딩 인덱스 생성 (InsightFace Buffalo_L 모델 사용)
python backend\scripts\build_actor_index_insightface.py --dataset-dir C:\data\actors
```

**실행 결과 확인**:
```
✅ backend/app/data/embeddings.npy 생성됨
✅ backend/app/data/metadata.json 생성됨
✅ backend/app/data/actors/ 폴더에 대표 이미지 복사됨
```

### 2단계: 서버 실행 🚀

#### 2-1. 백엔드 서버 시작

새 PowerShell 터미널을 열고:

```powershell
cd C:\Users\disco\Desktop\LandingPage\Imagematch
.\.venv\Scripts\Activate
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**확인**: http://localhost:8000/health 접속 시 `{"status":"ok"}` 표시되어야 함

#### 2-2. 프론트엔드 서버 시작

또 다른 PowerShell 터미널을 열고:

```powershell
cd C:\Users\disco\Desktop\LandingPage\Imagematch\frontend
npm run dev
```

**확인**: 브라우저에서 http://localhost:3000 접속

### 3단계: 서비스 사용 테스트 🎯

#### 3-1. 레퍼런스 배우 입력
- "1️⃣ 레퍼런스 배우 입력" 섹션에 배우 이름 입력
- 예: "송강호", "전지현", "마동석"
- **중요**: 1단계에서 생성한 폴더 이름과 정확히 일치해야 합니다!

#### 3-2. 지원자 사진 업로드
- "2️⃣ 지원자 사진 업로드" 영역에 오디션 지원자 사진을 드래그&드롭
- 또는 클릭하여 파일 선택
- 여러 명의 지원자 사진을 한 번에 업로드 가능

#### 3-3. 인원 수 설정
- "3️⃣ 보고 싶은 인원 수" 슬라이더 조절
- Top 1 ~ Top 10까지 선택 가능

#### 3-4. 분석 시작
- "4️⃣ AI 분석 시작 ✨" 버튼 클릭

#### 3-5. 결과 확인
- "5️⃣ [레퍼런스 배우] 닮은 순위" 섹션에서 결과 확인
- 각 지원자별로:
  - 레퍼런스 배우와의 유사도 점수 (0-100%)
  - 가장 유사한 배우 Top-K 리스트
  - 레퍼런스 배우는 🎯 표시로 강조됨

## 🔍 동작 원리

1. **레퍼런스 배우 입력**: 사용자가 입력한 배우 이름
2. **지원자 분석**: 각 지원자 이미지를 CLIP 모델로 임베딩 변환
3. **유사도 계산**: 배우 데이터베이스와 코사인 유사도 비교
4. **레퍼런스 매칭**: Top-K 결과 중 레퍼런스 배우가 포함되어 있으면 강조 표시
5. **랭킹 표시**: 유사도 높은 순서대로 정렬하여 표시

## ⚠️ 중요 체크리스트

### 필수 작업
- [ ] 배우 이미지 폴더 준비 (C:\data\actors\배우이름\*.jpg)
- [ ] 인덱스 생성 실행 (`build_actor_index.py`)
- [ ] `backend/app/data/embeddings.npy` 파일 존재 확인
- [ ] `backend/app/data/metadata.json` 파일 존재 확인
- [ ] 백엔드 서버 실행 (포트 8000)
- [ ] 프론트엔드 서버 실행 (포트 3000)

### 테스트 확인
- [ ] 레퍼런스 배우 이름이 데이터베이스에 존재하는가?
- [ ] 지원자 사진이 정상적으로 업로드되는가?
- [ ] 분석 결과에 레퍼런스 배우가 표시되는가?
- [ ] 유사도 점수가 정상적으로 표시되는가?

## 🐛 문제 해결

### "503 Service Unavailable" 에러
**원인**: 배우 인덱스가 생성되지 않음  
**해결**: `build_actor_index.py` 스크립트를 실행하여 인덱스 생성

### 레퍼런스 배우가 결과에 표시되지 않음
**원인**: 입력한 배우 이름이 데이터베이스에 없거나 철자가 다름  
**해결**: 
- `backend/app/data/metadata.json` 파일을 열어 등록된 배우 이름 확인
- 정확한 철자로 입력 (대소문자, 공백 포함)

### "Connection Refused" 에러
**원인**: 백엔드 서버가 실행되지 않음  
**해결**: 백엔드 터미널에서 uvicorn 서버 실행 확인

### 느린 분석 속도
**원인**: CPU 모드로 실행 중  
**해결**: 
- GPU 사용 시: PyTorch CUDA 버전 설치
- CPU 사용 시: 정상 (최초 로드 시 10-20초 소요)

## 📊 예상 사용 시나리오

### 시나리오 1: "송강호 같은 느낌의 배우 찾기"
1. 레퍼런스: "송강호" 입력
2. 지원자 20명의 사진 업로드
3. Top 5로 설정
4. 분석 → 각 지원자마다 송강호와의 유사도 포함한 Top 5 배우 표시
5. 송강호 유사도가 높은 지원자부터 검토

### 시나리오 2: "다양한 배우들과 비교"
1. 레퍼런스: "전지현" 입력
2. 여성 지원자 10명 사진 업로드
3. Top 10으로 설정
4. 전지현이 포함된 결과 확인
5. 전지현과 가까운 순서대로 정렬된 지원자 검토

## 💡 팁

1. **고품질 이미지 사용**: 해상도가 높고 선명한 정면 사진이 가장 좋은 결과를 냅니다
2. **다양한 각도**: 배우 데이터베이스에 여러 각도의 사진을 넣으면 정확도가 향상됩니다
3. **배치 처리**: 여러 지원자를 한 번에 업로드하면 효율적입니다
4. **레퍼런스 변경**: 다른 레퍼런스 배우로 재분석하려면 이름만 바꾸고 다시 분석하면 됩니다

---

**문의**: disco922@naver.com
